<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeroQuest Rüstkammer - Fanmade Miniatures & More</title>
    <!-- Stripe.js Script for payment processing -->
    <script src="https://js.stripe.com/v3/"></script>
    <!-- Thematic font for all text -->
    <link href="https://db.onlinewebfonts.com/c/fab6c5f31943098e66f2a6118872a832?family=Carter+Sans+W04+Bold" rel="stylesheet">
    <style>
        /*
        ==========================================================================
        DESIGN SYSTEM & GLOBAL STYLES (DEEPER DARK THEME)
        ==========================================================================
        */
        :root {
            --bg-dark-stone: #1a1410;
            --bg-light-source: #2f2821;
            --card-bg: #2c251e;
            --text-parchment: #eaddc0;
            --text-light: #ffffff;
            --accent-gold: #e8b957;
            --glow-gold: #ffc75c;
            --glow-green: #6cc741;
            --border-dark: #110e0c;
            --success-green: #5a9e34;
            --error-red: #c53030;
            --font-display: 'Carter Sans W04 Bold', sans-serif;
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --border-radius: 5px;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: var(--font-display);
            margin: 0;
            background-color: var(--bg-dark-stone);
            background-image:
                url('https://www.transparenttextures.com/patterns/dark-matter.png'),
                radial-gradient(circle at top, #28221c, var(--bg-dark-stone));
            background-attachment: fixed;
            color: var(--text-parchment);
            line-height: 1.6;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        body.modal-open {
            overflow: hidden;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }

        h1, h2, h3, h4 {
            font-family: var(--font-display);
            color: var(--text-light);
            margin: 0 0 var(--spacing-md) 0;
        }

        p { margin: 0 0 var(--spacing-md) 0; }
        a { color: var(--accent-gold); text-decoration: none; }
        a:hover { text-decoration: none; color: var(--glow-gold); }

        /*
        ==========================================================================
        CONSTRUCTION BANNER
        ==========================================================================
        */
        #construction-banner {
            background-color: var(--accent-gold);
            color: var(--bg-dark-stone);
            text-align: center;
            padding: 0.6rem 1rem;
            position: sticky;
            top: 0;
            z-index: 501; /* Higher than header's z-index */
            border-bottom: 1px solid var(--border-dark);
        }
        #construction-banner p {
            margin: 0;
            font-size: 0.95rem;
            line-height: 1.5;
            font-weight: bold;
            text-shadow: none;
        }

        /*
        ==========================================================================
        HEADER & NAVIGATION
        ==========================================================================
        */
        header {
            padding: var(--spacing-sm) 0;
            border-bottom: 2px solid var(--border-dark);
            background-color: rgba(0,0,0,0.4);
            position: sticky;
            top: 0; /* This will be dynamically adjusted by JavaScript */
            z-index: 500;
            backdrop-filter: blur(8px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .heroquest-logo {
            max-width: 150px;
            height: auto;
            filter: drop-shadow(0 4px 15px rgba(0,0,0,0.8)) drop-shadow(0 0 5px var(--glow-gold));
            z-index: 1002;
            transition: max-width 0.3s ease;
        }
        
        .main-nav ul {
            margin: 0;
            padding: 0;
            list-style: none;
            display: flex;
            gap: var(--spacing-lg);
        }
        .main-nav a {
            font-size: 1.2rem;
            color: var(--text-parchment);
            transition: color 0.3s, text-shadow 0.3s;
            padding: var(--spacing-sm) 0;
        }
        .main-nav a:hover, .main-nav li.active a {
            color: var(--accent-gold);
            text-shadow: 0 0 8px var(--glow-gold);
        }
        
        .hamburger-menu { display: none; }
        .nav-right-cluster { display: flex; align-items: center; gap: var(--spacing-md); transition: gap 0.3s ease; }
        
        /* Language Switcher Styles */
        .language-switcher {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            color: var(--text-parchment);
        }
        .language-switcher a {
            color: var(--text-parchment);
            font-size: 1rem;
            padding: var(--spacing-xs);
            font-weight: bold;
            border: 2px solid transparent;
            border-radius: var(--border-radius);
        }
        .language-switcher a.active {
            color: var(--accent-gold);
            text-shadow: 0 0 0px var(--glow-gold);
            border-color: var(--accent-gold);
        }
         .language-switcher a:not(.active):hover {
             color: var(--glow-gold);
        }
        .language-switcher span {
             opacity: 0.5;
        }


        #cart-icon-wrapper { position: relative; }
        .header-icon {
            font-size: 1.8rem; color: var(--accent-gold); cursor: pointer; transition: all 0.3s;
            background: var(--card-bg); border: 2px solid var(--border-dark);
            padding: var(--spacing-sm); border-radius: var(--border-radius);
            display: flex; align-items: center; justify-content: center;
        }
        .header-icon:hover { color: var(--glow-gold); transform: scale(1.05); box-shadow: 0 0 10px var(--glow-gold); }
        .header-icon svg {
            width: 28px; height: 28px; stroke: currentColor;
            stroke-width: 1.5; fill: none;
            stroke-linecap: round; stroke-linejoin: round;
        }
        #cart-counter { position: absolute; top: -8px; right: -8px; background-color: var(--error-red); color: white; border-radius: 50%; padding: 1px 6px; font-size: 0.75rem; font-weight: bold; border: 2px solid #000; display: none; }

        .main-showcase {
            padding: var(--spacing-xl) 0;
            text-align: center;
            flex-grow: 1;
        }
        .main-showcase h2 {
            font-size: clamp(2rem, 5vw, 2.8rem);
            text-shadow: 3px 3px 10px #000;
        }
        .main-showcase p {
            font-size: clamp(1rem, 3vw, 1.1rem);
            color: var(--accent-gold);
            max-width: 60ch;
            margin: var(--spacing-sm) auto var(--spacing-xl) auto;
        }

        /*
        ==========================================================================
        PRODUCT CARDS & GRID
        ==========================================================================
        */
        .showcase-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: var(--spacing-lg);
            min-height: 450px;
        }

        .showcase-item {
            background-color: var(--card-bg);
            border: 2px solid var(--border-dark);
            border-radius: var(--border-radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(0,0,0,0.7);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex: 0 1 300px;
        }
        .showcase-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.9), 0 0 25px var(--glow-gold);
        }
        .showcase-item__image-container {
            background-color: var(--border-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-sm);
            position: relative;
        }
        .showcase-item img {
            max-width: 100%;
            height: 200px;
            object-fit: contain;
        }
        .showcase-item__content {
            padding: var(--spacing-lg);
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        .showcase-item h3 { font-size: clamp(1.25rem, 5vw, 1.5rem); }
        .showcase-item p { flex-grow: 1; min-height: 40px; }

        .price-container {
            margin-bottom: var(--spacing-lg);
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-gold);
            min-height: 2.5rem; /* Reserve space to prevent layout shifts */
        }
        .original-price {
            font-size: 1rem;
            text-decoration: line-through;
            opacity: 0.6;
            margin-right: var(--spacing-sm);
        }
        .sale-badge {
            position: absolute;
            top: var(--spacing-md);
            left: var(--spacing-md);
            background-color: var(--error-red);
            color: var(--text-light);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: bold;
            border: 1px solid var(--border-dark);
        }

        /*
        ==========================================================================
        BUTTONS
        ==========================================================================
        */
        .btn { display: inline-block; color: var(--text-light); text-shadow: 1px 1px 2px #000; padding: 0.75rem 1.5rem; border: 2px solid var(--border-dark); border-radius: var(--border-radius); text-decoration: none; font-weight: bold; font-family: var(--font-display); font-size: 1rem; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 8px rgba(0,0,0,0.7), inset 0 1px 1px rgba(255,255,255,0.1); text-align: center; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); }
        .btn:disabled { background-image: linear-gradient(to bottom, #555, #333); cursor: not-allowed; box-shadow: inset 0 2px 4px rgba(0,0,0,0.4); opacity: 0.7; }
        .btn.btn-primary { background-image: linear-gradient(to bottom, #b48b48, #8c6d3a); }
        .btn.btn-primary:hover:not(:disabled) { background-image: linear-gradient(to bottom, #d4aa50, #b48b48); box-shadow: 0 0 15px var(--glow-gold); }
        .btn.btn-secondary { background-image: linear-gradient(to bottom, #777, #555); }
        .btn.btn-secondary:hover:not(:disabled) { background-image: linear-gradient(to bottom, #888, #666); box-shadow: 0 0 10px #aaa; }
        .btn.btn-success { background-image: linear-gradient(to bottom, var(--success-green), #447828); }
        .btn.btn-success:hover:not(:disabled) { background-image: linear-gradient(to bottom, var(--glow-green), var(--success-green)); box-shadow: 0 0 15px var(--glow-green); }
        .btn-full-width { display: block; width: 100%; }
        
        /*
        ==========================================================================
        MODALS & SLIDESHOW
        ==========================================================================
        */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); backdrop-filter: blur(8px); z-index: 1000; padding: var(--spacing-sm); box-sizing: border-box; align-items: center; justify-content: center; animation: fadeIn 0.3s ease; }
        .modal-overlay.active { display: flex; }
        .modal-content { width: 100%; max-width: 600px; max-height: 88vh; background-color: var(--bg-light-source); border: 3px solid var(--accent-gold); box-shadow: 0 0 40px rgba(0,0,0,1), inset 0 0 25px rgba(0,0,0,0.6); position: relative; box-sizing: border-box; display: flex; flex-direction: column; overflow: hidden; border-radius: var(--border-radius); }
        .modal-header { padding: var(--spacing-md); border-bottom: 2px solid var(--border-dark); text-align: center; background-color: rgba(0,0,0,0.3); flex-shrink: 0; }
        .modal-header h2 { margin-bottom: 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.7); font-size: 1.5rem; }
        .modal-body { padding: var(--spacing-lg); overflow-y: auto; background-color: var(--bg-dark-stone); }
        .modal-footer { padding: var(--spacing-md); border-top: 2px solid var(--border-dark); background-color: rgba(0,0,0,0.3); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-md); flex-shrink: 0; }
        .close-btn { position: absolute; top: var(--spacing-xs); right: var(--spacing-xs); font-size: 2.5rem; color: var(--text-parchment); cursor: pointer; text-shadow: 1px 1px 2px #000; z-index: 10; background: none; border: none; padding: 0.5rem; line-height: 1; transition: color 0.3s, transform 0.3s; }
        .close-btn:hover { color: var(--glow-gold); transform: scale(1.1); }
        
        .product-content .modal-body { padding: 0; background: transparent; }
        .product-info-scrollable { padding: var(--spacing-lg); text-align: center; }
        .product-info-scrollable h1 { font-size: 1.8rem; }
        .product-info-scrollable .price-container { font-size: 1.8rem; }
        .product-info-scrollable .original-price { font-size: 1.2rem; }

        /* Slideshow */
        .slideshow-wrapper { position: relative; display: flex; align-items: center; justify-content: center; padding: var(--spacing-md) 0; }
        .slideshow-container { max-width: 500px; width: 100%; position: relative; background-color: #000; border: 2px solid var(--accent-gold); box-shadow: 0 5px 15px rgba(0,0,0,0.5); min-height: 250px; display:flex; align-items:center; justify-content:center;}
        .slide { display: none; animation: fade 1s; }
        .slide.active { display: block; }
        .slide img { vertical-align: middle; max-width: 100%; max-height: 300px; object-fit: contain; }
        .slide-arrow {
            cursor: pointer; color: var(--accent-gold); font-weight: bold; font-size: 2rem;
            transition: 0.3s ease; user-select: none; z-index: 5; background: rgba(0,0,0,0.4);
            border: none; border-radius: 50%; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            position: absolute; top: 50%; transform: translateY(-50%);
        }
        .slide-arrow.prev { left: var(--spacing-md); }
        .slide-arrow.next { right: var(--spacing-md); }
        .slide-arrow:hover { color: var(--glow-gold); background: rgba(0,0,0,0.6); }
        .dot-container { text-align: center; padding-top: var(--spacing-sm); }
        .dot {
            cursor: pointer;
            height: 14px;
            width: 14px;
            margin: 0 4px;
            background-color: #717171;
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.6s ease;
            border: 1px solid var(--accent-gold);
            padding: 0;
        }
        .dot.active, .dot:hover { background-color: var(--glow-gold); }
        @keyframes fade { from {opacity: .4} to {opacity: 1} }

        /*
        ==========================================================================
        CART & CHECKOUT
        ==========================================================================
        */
        #cart-items-list { list-style: none; padding: 0; margin:0; }
        .cart-item { display: flex; align-items: center; padding: var(--spacing-md) 0; border-bottom: 1px solid var(--border-dark); gap: var(--spacing-md); flex-wrap: wrap; }
        .cart-item:last-child { border-bottom: none; }
        .cart-item img { width: 60px; height: 60px; object-fit: cover; border: 2px solid var(--border-dark); flex-shrink: 0; border-radius: var(--border-radius); }
        .cart-item-info { flex-grow: 1; text-align: left; }
        .cart-item-info h4 { margin: 0 0 5px 0; color: var(--text-light); font-size: 1.1rem; text-shadow: none; }
        .cart-item-controls { display: flex; align-items: center; }
        .cart-item-controls button { background: var(--card-bg); border: 1px solid var(--border-dark); color: var(--accent-gold); cursor: pointer; width: 30px; height: 30px; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; line-height: 1; padding: 0; transition: background-color 0.2s; }
        .cart-item-controls button:hover { background-color: var(--bg-light-source); }
        .cart-item-controls input { width: 40px; text-align: center; background: var(--bg-dark-stone); border: 1px solid var(--border-dark); color: var(--text-parchment); margin: 0 5px; -moz-appearance: textfield; height: 30px; box-sizing:border-box; }
        .cart-item-remove { background: none; border: none; color: var(--error-red); font-size: 1.8rem; cursor: pointer; margin-left: auto; transition: color 0.3s, transform 0.3s; }
        .cart-item-remove:hover { color: #ff5252; transform: scale(1.1); }
        #cart-total-container { text-align: right; margin-top: var(--spacing-lg); padding: var(--spacing-md); background-color: rgba(0,0,0,0.3); border-radius: var(--border-radius); }
        #cart-total { font-size: 1.25rem; color: var(--text-light); font-weight: bold; margin: 0; }
        #cart-total span { color: var(--accent-gold); font-family: var(--font-display); font-size: 1.5rem; margin-left: var(--spacing-sm); }
        
        .checkout-content { max-width: 500px; }
        #confirmation-modal .modal-body { text-align: center; }
        #confirmation-modal .modal-footer { justify-content: center; }

        .confirmation-icon {
            display: inline-block;
            width: 80px;
            height: 80px;
            position: relative;
            margin-bottom: var(--spacing-md);
        }
        .confirmation-icon::after {
            content: '';
            position: absolute;
            left: 25px;
            top: 10px;
            width: 25px;
            height: 50px;
            border: solid var(--glow-green);
            border-width: 0 10px 10px 0;
            transform: rotate(45deg);
        }
        
        /* Styles for the new upgrade feature box in checkout */
        .upgrade-option-box {
            background-color: var(--bg-light-source);
            border: 2px solid var(--accent-gold);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin: var(--spacing-lg) 0;
            box-shadow: 0 0 15px rgba(232, 185, 87, 0.3);
            text-align: left;
        }
        .upgrade-option-box h4 {
            color: var(--accent-gold);
            margin-top: 0;
            font-size: 1.2rem;
        }
        .upgrade-option-box p {
            font-size: 0.9rem;
            margin-bottom: var(--spacing-md);
            opacity: 0.9;
        }
        .upgrade-option-box label {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
        }
        .upgrade-option-box input[type="checkbox"] {
            transform: scale(1.5);
            accent-color: var(--glow-gold);
            cursor: pointer;
        }

        /*
        ==========================================================================
        FOOTER & TOAST
        ==========================================================================
        */
        .site-footer {
            background-color: var(--border-dark);
            color: var(--text-parchment);
            padding: var(--spacing-xl) 0;
            border-top: 2px solid #000;
        }
        .footer-copyright { text-align: center; font-size: 0.9rem; opacity: 0.6; }
        
        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 3000; display: flex; flex-direction: column; align-items: center; gap: 10px; width: 90%; max-width: 400px; }
        .toast { background-color: var(--card-bg); color: var(--text-parchment); padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--border-radius); border: 2px solid var(--accent-gold); box-shadow: 0 5px 20px rgba(0,0,0,0.9); animation: toast-in 0.5s forwards, toast-out 0.5s 5.5s forwards; opacity: 0; text-align: center; width: 100%; box-sizing: border-box; position: relative; }
        .toast-btn { margin-top: 0.75rem; padding: 0.4rem 0.8rem; font-size: 0.9rem; }
        .toast-close-btn {
            position: absolute; top: 0; right: 0;
            background: none; border: none;
            color: var(--text-parchment);
            font-size: 1.5rem; line-height: 1;
            padding: var(--spacing-sm);
            cursor: pointer;
            text-shadow: 1px 1px 2px #000;
        }
        .toast-close-btn:hover { color: var(--glow-gold); }
        @keyframes toast-in { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes toast-out { from { opacity: 1; } to { opacity: 0; } }
        @keyframes fadeIn { from {opacity: 0} to {opacity: 1} }

        /*
        ==========================================================================
        MOBILE & RESPONSIVE STYLES
        ==========================================================================
        */
        @media (max-width: 768px) {
            .main-nav {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background-color: var(--bg-dark-stone);
                background-image:
                    url('https://www.transparenttextures.com/patterns/dark-matter.png'),
                    radial-gradient(circle at top, #28221c, var(--bg-dark-stone));
                display: flex;
                align-items: center;
                justify-content: center;
                transition: transform 0.3s ease-in-out;
                transform: translateX(-100%);
                z-index: 1001;
            }

            .main-nav.active {
                transform: translateX(0);
            }

            .main-nav ul {
                flex-direction: column;
                gap: var(--spacing-xl);
                text-align: center;
            }

            .main-nav a {
                font-size: 2rem;
            }

            .hamburger-menu {
                display: block;
                z-index: 1100;
                background: none;
                border: none;
                cursor: pointer;
                padding: 0;
            }

            .hamburger-menu .bar {
                display: block;
                width: 28px;
                height: 3px;
                background-color: var(--accent-gold);
                margin: 5px 0;
                transition: all 0.3s ease-in-out;
            }

            .hamburger-menu.active .bar:nth-child(1) {
                transform: translateY(8px) rotate(45deg);
            }
            .hamburger-menu.active .bar:nth-child(2) {
                opacity: 0;
            }
            .hamburger-menu.active .bar:nth-child(3) {
                transform: translateY(-8px) rotate(-45deg);
            }

            .modal-footer {
                flex-direction: column;
                gap: var(--spacing-sm);
            }
            .modal-footer .btn {
                width: 100%;
            }

            .cart-item {
                gap: var(--spacing-sm);
            }

            .cart-item-info {
                flex-basis: 100%;
                text-align: center;
            }
            .cart-item-controls {
                margin: 0 auto;
            }
            .cart-item-remove {
                margin-left: 0;
                margin: 0 auto;
            }
        }
        
        @media (max-width: 480px) {
            .heroquest-logo {
                max-width: 120px;
            }
            .nav-right-cluster {
                gap: var(--spacing-sm);
            }
            .header-icon {
                padding: var(--spacing-xs);
            }
             .header-icon svg {
                width: 24px;
                height: 24px;
            }
        }

    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="#"><img src="Assets/trimmed (4).png" alt="HeroQuest Logo" class="heroquest-logo"></a>
                
                <div class="nav-right-cluster">
                    <nav class="main-nav" id="main-nav">
                        <ul id="nav-filters">
                            <li class="active"><a href="#" data-category="all" data-translate-key="nav_all">Alle</a></li>
                            <li><a href="#" data-category="neues" data-translate-key="nav_new">Neues</a></li>
                            <li><a href="#" data-category="angebote" data-translate-key="nav_offers">Angebote</a></li>
                            <li><a href="#" data-category="zubehoer" data-translate-key="nav_accessories">Zubehör</a></li>
                        </ul>
                    </nav>
                    
                    <div class="language-switcher">
                        <a href="#" class="lang-option" data-lang="de">DE</a>
                        <span>|</span>
                        <a href="#" class="lang-option" data-lang="en">EN</a>
                    </div>
                    
                    <a href="mailto:support@shadowquest.shop" class="header-icon" id="support-icon" data-translate-aria-label="aria_support" aria-label="Support kontaktieren">
                        <svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                    </a>

                    <div id="cart-icon-wrapper">
                        <button class="header-icon" id="cart-icon" data-translate-aria-label="aria_open_cart" aria-label="Warenkorb öffnen">
                            <svg viewBox="0 0 24 24"><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle></svg>
                        </button>
                        <span id="cart-counter">0</span>
                    </div>

                    <button class="hamburger-menu" id="hamburger-menu" data-translate-aria-label="aria_open_nav" aria-label="Navigation öffnen" aria-expanded="false" aria-controls="main-nav">
                        <span class="bar"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-showcase">
        <div class="container">
            <h2 data-translate-key="main_title">Fanmade Miniaturen & Zubehör</h2>
            <p data-translate-key="main_subtitle">Erweitere dein Abenteuer mit unseren hochdetaillierten, handgefertigten Miniaturen und Premium-Zubehör für HeroQuest.</p>
            <div class="showcase-grid" id="showcase-grid">
                <!-- Product items are dynamically inserted here -->
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-copyright" data-translate-key="footer_copyright">
                &copy; 2025 HeroQuest Rüstkammer. Alle Rechte vorbehalten.
            </div>
        </div>
    </footer>

    <!-- MODALS AND TEMPLATES -->
    <div id="modal-container"></div>
    
    <div id="cart-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="cart-heading">
        <div class="modal-content">
            <button class="close-btn" data-translate-aria-label="aria_close" aria-label="Schließen">&times;</button>
            <div class="modal-header">
                <h2 id="cart-heading" data-translate-key="cart_title">Warenkorb</h2>
            </div>
            <div class="modal-body">
                <ul id="cart-items-list"></ul>
                <div id="cart-total-container">
                    <p id="cart-total" data-translate-key="cart_total">Gesamt: <span>0,00 €</span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="clear-cart-btn" data-translate-key="cart_clear_btn">Warenkorb leeren</button>
                <button class="btn btn-success" id="go-to-checkout-btn" data-translate-key="cart_checkout_btn">Zur Kasse</button>
            </div>
        </div>
    </div>
    
    <div id="checkout-modal" class="modal-overlay" role="dialog" aria-modal="true">
        <div id="checkout-container" class="modal-content checkout-content"></div>
    </div>

    <div id="confirmation-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="confirmation-heading">
        <div class="modal-content">
             <button class="close-btn" data-translate-aria-label="aria_close" aria-label="Schließen">&times;</button>
            <div class="modal-header">
                 <h2 id="confirmation-heading" data-translate-key="confirm_title">Bestellung erfolgreich!</h2>
            </div>
            <div class="modal-body">
                <div class="confirmation-icon"></div>
                <p data-translate-key="confirm_thanks">Vielen Dank für deinen Einkauf in der Rüstkammer.</p>
                <p data-translate-key="confirm_email">Eine Bestätigung wurde per E-Mail versendet.</p>
            </div>
            <div class="modal-footer">
                 <button class="btn btn-primary" id="close-confirmation-btn" data-translate-key="confirm_continue_btn">Weiter einkaufen</button>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <template id="product-card-template">
        <div class="showcase-item">
            <div class="showcase-item__image-container">
                <img src="" alt="">
            </div>
            <div class="showcase-item__content">
               <h3 class="name"></h3>
               <p class="subtitle"></p>
               <div class="price-container"></div>
               <button class="btn btn-primary learn-more-btn" data-translate-key="product_details_btn">Details & Kaufen</button>
            </div>
        </div>
    </template>

    <template id="product-modal-template">
        <div class="modal-overlay product-modal" role="dialog" aria-modal="true">
            <div class="modal-content product-content">
                <button class="close-btn" data-translate-aria-label="aria_close" aria-label="Schließen">&times;</button>
                <div class="modal-body">
                    <div class="slideshow-wrapper">
                        <div class="slideshow-container"></div>
                        <button class="slide-arrow prev" data-translate-aria-label="aria_prev_image" aria-label="Vorheriges Bild">&#10094;</button>
                        <button class="slide-arrow next" data-translate-aria-label="aria_next_image" aria-label="Nächstes Bild">&#10095;</button>
                    </div>
                    <div class="product-info-scrollable">
                        <div class="dot-container"></div>
                        <h1 class="name"></h1>
                        <p class="description"></p>
                        <div class="price-container"></div>
                    </div>
                </div>
                 <div class="modal-footer" style="justify-content: center;">
                    <button class="btn btn-success buy-btn" data-translate-key="product_add_to_cart_btn">In den Warenkorb</button>
                </div>
            </div>
        </div>
    </template>

    <template id="cart-item-template">
        <li class="cart-item">
            <img src="" alt="" class="cart-item-img">
            <div class="cart-item-info">
                <h4 class="cart-item-name"></h4>
                <p class="cart-item-price" style="margin: 0; color: var(--accent-gold);"></p>
            </div>
            <div class="cart-item-controls">
                <button class="quantity-btn" data-action="decrease" data-translate-aria-label="aria_decrease_qty" aria-label="Menge verringern">-</button>
                <input type="number" value="1" min="1" class="quantity-input" data-translate-aria-label="aria_quantity" aria-label="Menge">
                <button class="quantity-btn" data-action="increase" data-translate-aria-label="aria_increase_qty" aria-label="Menge erhöhen">+</button>
            </div>
            <button class="cart-item-remove" data-translate-aria-label="aria_remove_item" aria-label="Artikel entfernen">&times;</button>
        </li>
    </template>


    <script>
    const App = {
        // --- TRANSLATION SYSTEM ---
        currentLanguage: 'de',
        translations: {
            de: {
                nav_all: "Alle",
                nav_new: "Neues",
                nav_offers: "Angebote",
                nav_accessories: "Zubehör",
                main_title: "Fanmade Miniaturen & Zubehör",
                main_subtitle: "Erweitere dein Abenteuer mit unseren hochdetaillierten, handgefertigten Miniaturen und Premium-Zubehör für HeroQuest.",
                footer_copyright: "© 2025 HeroQuest Rüstkammer. Alle Rechte vorbehalten.",
                product_details_btn: "Details & Kaufen",
                product_add_to_cart_btn: "In den Warenkorb",
                cart_title: "Warenkorb",
                cart_total: "Gesamt:",
                cart_clear_btn: "Warenkorb leeren",
                cart_checkout_btn: "Zur Kasse",
                cart_empty: "Dein Warenkorb ist leer.",
                cart_clear_confirm: "Möchtest du den Warenkorb wirklich leeren?",
                checkout_title: "Bestellübersicht",
                checkout_pay_btn: "Sicher mit Stripe bezahlen",
                checkout_redirecting_btn: "Leite zu Stripe weiter...",
                checkout_shipping: "Versand",
                checkout_shipping_de: "Versand (Deutschland)",
                checkout_shipping_int: "Versand (International)",
                checkout_subtotal: "Zwischensumme",
                checkout_grand_total: "Gesamtsumme",
                checkout_upgrade_title: "Optional: 100% Originalgetreue Karten",
                checkout_upgrade_desc: "Verbessere alle Karten deines Sets auf höchste Sammlerqualität. Originale Textur, Eckenradius und Haptik für nur 19,90 € extra.",
                checkout_upgrade_label: "Ja, ich möchte das Upgrade für 19,90 €",
                checkout_upgrade_item_name: "Upgrade: Originalgetreue Karten",
                confirm_title: "Bestellung erfolgreich!",
                confirm_thanks: "Vielen Dank für deinen Einkauf in der Rüstkammer.",
                confirm_email: "Eine Bestätigung wurde per E-Mail versendet.",
                confirm_continue_btn: "Weiter einkaufen",
                toast_item_added: "{itemName} wurde hinzugefügt!",
                toast_view_cart_btn: "Warenkorb ansehen",
                toast_payment_cancelled: "Die Zahlung wurde abgebrochen.",
                no_products_found: "Keine Produkte in dieser Kategorie gefunden.",
                sale_badge: "{percent}% RABATT",
                aria_open_cart: "Warenkorb öffnen",
                aria_open_nav: "Navigation öffnen",
                aria_close: "Schließen",
                aria_support: "Support kontaktieren",
                aria_prev_image: "Vorheriges Bild",
                aria_next_image: "Nächstes Bild",
                aria_decrease_qty: "Menge verringern",
                aria_increase_qty: "Menge erhöhen",
                aria_quantity: "Menge",
                aria_remove_item: "Artikel entfernen"
            },
            en: {
                nav_all: "All",
                nav_new: "New",
                nav_offers: "Offers",
                nav_accessories: "Accessories",
                main_title: "Fanmade Miniatures & Accessories",
                main_subtitle: "Expand your adventure with our highly detailed, handcrafted miniatures and premium accessories for HeroQuest.",
                footer_copyright: "© 2025 HeroQuest Armory. All rights reserved.",
                product_details_btn: "Details & Buy",
                product_add_to_cart_btn: "Add to Cart",
                cart_title: "Shopping Cart",
                cart_total: "Total:",
                cart_clear_btn: "Clear Cart",
                cart_checkout_btn: "To Checkout",
                cart_empty: "Your shopping cart is empty.",
                cart_clear_confirm: "Are you sure you want to empty the cart?",
                checkout_title: "Order Summary",
                checkout_pay_btn: "Pay securely with Stripe",
                checkout_redirecting_btn: "Redirecting to Stripe...",
                checkout_shipping: "Shipping",
                checkout_shipping_de: "Shipping (Germany)",
                checkout_shipping_int: "Shipping (International)",
                checkout_subtotal: "Subtotal",
                checkout_grand_total: "Grand Total",
                checkout_upgrade_title: "Optional: 100% Original Grade Cards",
                checkout_upgrade_desc: "Upgrade all cards in your set to the highest collector's quality. Original texture, corner radius, and feel for just €19.90 extra.",
                checkout_upgrade_label: "Yes, I want the upgrade for €19.90",
                checkout_upgrade_item_name: "Upgrade: Original Grade Cards",
                confirm_title: "Order Successful!",
                confirm_thanks: "Thank you for your purchase at the Armory.",
                confirm_email: "A confirmation has been sent by email.",
                confirm_continue_btn: "Continue Shopping",
                toast_item_added: "{itemName} has been added!",
                toast_view_cart_btn: "View Cart",
                toast_payment_cancelled: "The payment was cancelled.",
                no_products_found: "No products found in this category.",
                sale_badge: "{percent}% OFF",
                aria_open_cart: "Open shopping cart",
                aria_open_nav: "Open navigation",
                aria_close: "Close",
                aria_support: "Contact support",
                aria_prev_image: "Previous image",
                aria_next_image: "Next image",
                aria_decrease_qty: "Decrease quantity",
                aria_increase_qty: "Increase quantity",
                aria_quantity: "Quantity",
                aria_remove_item: "Remove item"
            }
        },
        
        // --- PRODUCT DATA ---
        productData: {
            "rogue-heir-elethorn": {
                name: { de: "Schurke von Elethorn", en: "Rogue Heir Elethorn" },
                subtitle: { de: "Schurke von Elethorn Special Edition Deutsch", en: "Rogue Heir Elethorn Special Edition German" },
                description: { de: "Tauchen Sie in die Welt von HeroQuest ein und ergänzen Sie Ihr Spiel mit dem FAN-gefertigten Karten-Set “Schurke von Elethorn”. Dieses Set ist ausschließlich für Sammler und Spieler in Deutschland konzipiert und bietet eine exquisite Ergänzung für Ihre HeroQuest-Sammlung.", en: "Immerse yourself in the world of HeroQuest and enhance your game with the fan-made card set “Rogue of Elethorn.” This set is designed exclusively for collectors and players in Germany and offers an exquisite addition to your HeroQuest collection." },
                originalPrice: 189.90,
                img: "Assets/Download.png",
                images: ["Assets/Download.png", "https://www.blacksbricks.de/images/product_images/original_images/rogueheirhq31.jpg", "https://i.ebayimg.com/images/g/8Y4AAeSw8O1o~AQk/s-l1600.webp"],
                category: "neues"
            },
            "demonhunter": {
                name: { de: "Der Dämonenjäger", en: "The Demon Hunter" },
                subtitle: { de: "Fanmade Hero Collection aus 2 Helden", en: "Fanmade Hero Collection of 2 Heroes" },
                description: { de: "Heroquest Fanmade Hero Collection. Dämonenjäger (2x) Miniatur im (2021) Heroquest 28 mm Maßstab mit runder Base. Karten (Heldenwerte und Fähigkeiten) in deutscher /englischer Sprachausgabe. Farbe: Heroquest Heldentypisch Rot. Zur Erweiterung der Spielerfahrung im berühmten Dungeon Crawler. Spielerisch kompatibel mit dem Original Heroquest aus dem Jahr 1989. Beachte: Runde Base! Mehr Auswahl an Miniaturen für Spieler und Spielleiter. Hergestellt in Deutschland. Lieferzeit bis zu 5 Werktage.", en: "HeroQuest Fanmade Hero Collection. Demon Hunter (2x) miniature in (2021) HeroQuest 28 mm scale with round base. Cards (hero stats and abilities) in German/English language versions. Color: HeroQuest hero-typical red. For expanding the gameplay experience in the famous dungeon crawler. Fully compatible with the original HeroQuest from 1989. Note: round base! More miniature options for players and game masters. Made in Germany. Delivery time up to 5 business days."},
                originalPrice: 159.90,
                img: "https://i.ebayimg.com/images/g/~~EAAeSwuklo95kV/s-l1600.webp",
                images: ["https://i.ebayimg.com/images/g/~~EAAeSwuklo95kV/s-l1600.webp", "https://i.ebayimg.com/images/g/wCkAAeSwU95o8Rl4/s-l1600.webp", "https://i.ebayimg.com/images/g/kzsAAeSwxVlo3Vr9/s-l1600.webp", "https://i.ebayimg.com/images/g/xF8AAeSwfpJo3Vr-/s-l1600.webp", "https://i.ebayimg.com/images/g/RUYAAeSwVNZo3Vr9/s-l1600.webp", "https://i.ebayimg.com/images/g/O9QAAeSwwb1o3Vr9/s-l1600.webp"],
                category: "neues"
            },
            "witch": {
                name: { de: "Die Hexe", en: "The Witch" },
                subtitle: { de: "Fanmade Hero Collection aus 2 Helden", en: "Fanmade Hero Collection of 2 Heroes" },
                description: { de: "2x Hexe alternative miniaturen", en: "2x witch alternative miniatures" },
                originalPrice: 159.90,
                img: "Assets/Download.png",
                images: ["Assets/Download.png", "https://i.ebayimg.com/images/g/xF8AAeSwfpJo3Vr-/s-l1600.webp"],
                category: "neues"
            },
            "ranger": {
                name: { de: "Der Waldläufer", en: "The Ranger" },
                subtitle: { de: "Fanmade Hero Collection aus 2 Helden", en: "Fanmade Hero Collection of 2 Heroes" },
                description: { de: "Heroquest Fanmade Hero Collection. Waldläufer und Waldläuferin (2x) Miniatur im (2021) Heroquest 28 mm Maßstab mit runder Base. Männlich und Weiblich. Karten (Heldenwerte und Fähigkeiten) in deutscher Sprachausgabe. Farbe: Heroquest Heldentypisch Rot. Zur Erweiterung der Spielerfahrung im berühmten DungeonCrawler. Spielerisch kompatibel mit dem Original Heroquest aus dem Jahr 1989. Beachte: Runde Base! Mehr Auswahl an Miniaturen für Spieler und Spielleiter. Hergestellt in Italien. Lieferzeit max. 14 Tage aus Italien. Nach Lieferung aus Italien direkter Versand an Käufer per DHL.", en: "HeroQuest Fanmade Hero Collection. Ranger and Female Ranger (2x) miniature in (2021) HeroQuest 28 mm scale with round base. Male and female versions. Cards (hero stats and abilities) in German language version. Color: HeroQuest hero-typical red. Designed to expand the gameplay experience in the famous dungeon crawler. Fully compatible with the original HeroQuest from 1989. Note: round base! More miniature options for players and game masters. Made in Italy. Delivery time up to 14 days from Italy. After arrival from Italy, direct shipping to the buyer via DHL." },
                originalPrice: 159.90,
                discountPrice: 139.90,
                img: "https://i.ebayimg.com/images/g/nvEAAeSw9Qto9hPK/s-l1600.webp",
                images: ["https://i.ebayimg.com/images/g/nvEAAeSw9Qto9hPK/s-l1600.webp", "https://i.ebayimg.com/images/g/XRAAAeSwJE1o9hPL/s-l1600.webp"],
                category: "angebote"
            },
            "sleeves": {
                name: { de: "Premium Card Sleeves", en: "Premium Card Sleeves" },
                subtitle: { de: "100 Stk. für alle Karten", en: "100 pcs. for all cards" },
                description: { de: "Schütze deine wertvollen Spielkarten vor Abnutzung mit diesen passgenauen Premium-Sleeves in matter Ausführung.", en: "Protect your valuable game cards from wear and tear with these custom-fit premium sleeves in a matte finish." },
                originalPrice: 29.90,
                discountPrice: 19.90,
                img: "https://www.indanett.de/wp-content/uploads/2025/01/heroquest-sleeves-barbar-gesleevt-413x550.jpg",
                images: ["https://www.indanett.de/wp-content/uploads/2025/01/heroquest-sleeves-barbar-gesleevt-413x550.jpg", "https://www.indanett.de/wp-content/uploads/2025/01/heroquest-sleeves-cardbox-seitlich-550x413.jpg"],
                category: "zubehoer"
            },
            "chaos-warrior": {
                name: { de: "Drokmar, der rebllische Ork", en: "Drokmar, the rebellious orc" },
                subtitle: { de: "Fanmade Hero Collection aus einem Held", en: "Fanmade Hero Collection of one Hero" },
                description: { de: "Tauchen Sie ein in die Welt von HeroQuest und entdecken Sie Drok-Mar, den rebellischen Ork, der sich in die Sammlung exklusiver Fanmade Charaktere einreiht. Dieser markenlose Miniaturheld besticht durch seine detailreiche Gestaltung und ist ein Muss für Sammler und Spieler, die ihre Decks mit außergewöhnlichen Figuren bereichern möchten. Ideal für Rollenspiele und Tabletop-Schlachten, ist Drok-Mar bereit, sich Ihren Abenteuern anzuschließen und mit seiner unverwechselbaren Persönlichkeit und Kraft zu beeindrucken. Achtung ⚠️ Lieferzeit ca. 10 Tage.", en: "Immerse yourself in the world of HeroQuest and discover Drok-Mar, the rebellious orc who joins the collection of exclusive fan-made characters. This unbranded miniature hero stands out with its detailed design and is a must-have for collectors and players looking to enhance their decks with extraordinary figures. Perfect for role-playing and tabletop battles, Drok-Mar is ready to join your adventures and impress with his unique personality and strength. ⚠️ Please note: delivery time approximately 10 days." },
                originalPrice: 99.90,
                discountPrice: 65.90,
                img: "https://img.kleinanzeigen.de/api/v1/prod-ads/images/cd/cd39df20-7820-4a23-845d-9f8df4fc7ca0?rule=$_59.AUTO",
                images: ["https://img.kleinanzeigen.de/api/v1/prod-ads/images/cd/cd39df20-7820-4a23-845d-9f8df4fc7ca0?rule=$_59.AUTO", "https://img.kleinanzeigen.de/api/v1/prod-ads/images/bc/bc972e09-790c-4f19-8599-73de88a80c30?rule=$_59.AUTO", "https://img.kleinanzeigen.de/api/v1/prod-ads/images/72/72d35243-d64d-4f6e-bdc9-0e6f6647f725?rule=$_59.AUTO", "https://img.kleinanzeigen.de/api/v1/prod-ads/images/34/34862c49-eda2-477d-8d0b-11d64fd41142?rule=$_59.AUTO", "https://img.kleinanzeigen.de/api/v1/prod-ads/images/53/5364469b-148b-41a9-ba97-b93259519356?rule=$_59.AUTO", "https://img.kleinanzeigen.de/api/v1/prod-ads/images/a6/a6b396d6-c1ff-4e79-9896-efc175f0b9ef?rule=$_59.AUTO", "https://img.kleinanzeigen.de/api/v1/prod-ads/images/43/43599ab0-825e-4c7f-9073-b560ba0e500f?rule=$_59.AUTO", "https://img.kleinanzeigen.de/api/v1/prod-ads/images/51/512e4a38-603d-4391-8ff2-3e1dfd297427?rule=$_59.AUTO", "https://img.kleinanzeigen.de/api/v1/prod-ads/images/84/8415a4c1-8046-4815-90f6-017a9cf3ac44?rule=$_59.AUTO"],
                category: "neues"
            }
        },
        cart: [],
        activeModal: null,
        lastFocusedElement: null,
        
        // --- INITIALIZATION ---
        init() {
            this.cacheDOMElements();
            this.setLanguage(localStorage.getItem('userLanguage') || 'de');
            this.loadCartFromStorage(); // Must run after setLanguage to get correct names
            this.bindEvents();
            this.checkPaymentStatus();
        },

        cacheDOMElements() {
            this.dom = {
                html: document.documentElement,
                showcaseGrid: document.getElementById('showcase-grid'),
                navFilters: document.getElementById('nav-filters'),
                modalContainer: document.getElementById('modal-container'),
                cartModal: document.getElementById('cart-modal'),
                cartItemsList: document.getElementById('cart-items-list'),
                cartCounter: document.getElementById('cart-counter'),
                cartTotal: document.getElementById('cart-total'),
                checkoutBtn: document.getElementById('go-to-checkout-btn'),
                checkoutModal: document.getElementById('checkout-modal'),
                checkoutContainer: document.getElementById('checkout-container'),
                confirmationModal: document.getElementById('confirmation-modal'),
                toastContainer: document.getElementById('toast-container'),
                hamburgerMenu: document.getElementById('hamburger-menu'),
                mainNav: document.getElementById('main-nav'),
                languageSwitcher: document.querySelector('.language-switcher'),
                templates: {
                    productCard: document.getElementById('product-card-template'),
                    productModal: document.getElementById('product-modal-template'),
                    cartItem: document.getElementById('cart-item-template'),
                }
            };
        },

        bindEvents() {
            document.body.addEventListener('click', this.handleDelegatedClick.bind(this));
            document.addEventListener('keydown', this.handleKeyboard.bind(this));
            document.body.addEventListener('input', this.handleDelegatedInput.bind(this));
            document.body.addEventListener('change', this.handleDelegatedChange.bind(this));
            this.dom.hamburgerMenu.addEventListener('click', this.toggleNav.bind(this));
        },
        
        // --- TRANSLATION LOGIC ---
        setLanguage(lang) {
            if (!this.translations[lang]) return;
            this.currentLanguage = lang;
            localStorage.setItem('userLanguage', lang);
            this.dom.html.lang = lang;

            // Update static text
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                el.textContent = this.translations[lang][key] || el.textContent;
            });

            // Update ARIA labels
            document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                const key = el.dataset.translateAriaLabel;
                el.setAttribute('aria-label', this.translations[lang][key] || el.getAttribute('aria-label'));
            });

            // Update language switcher UI
            this.dom.languageSwitcher.querySelectorAll('.lang-option').forEach(el => {
                el.classList.toggle('active', el.dataset.lang === lang);
            });

            // Re-render dynamic content
            const activeCategory = this.dom.navFilters.querySelector('li.active a').dataset.category;
            this.renderProducts(activeCategory);
            this.updateCartUI();
        },

        // --- EVENT HANDLERS ---
        handleDelegatedClick(e) {
            const langButton = e.target.closest('.lang-option');
            if (langButton) {
                e.preventDefault();
                this.setLanguage(langButton.dataset.lang);
                return;
            }
            
            const target = e.target.closest('button, .modal-overlay, #nav-filters a, .dot');
            if (!target) return;

            if (target.matches('#nav-filters a')) {
                e.preventDefault(); 
                this.dom.navFilters.querySelector('li.active').classList.remove('active');
                target.parentElement.classList.add('active'); 
                this.renderProducts(target.dataset.category);
                if (this.dom.mainNav.classList.contains('active')) this.toggleNav();
                return;
            }

            if (target.matches('.learn-more-btn')) { this.openModal(document.getElementById(target.dataset.modalTarget)); return; }
            if (target.matches('#cart-icon')) { this.openModal(this.dom.cartModal); return; }
            if (target.matches('.close-btn, #close-confirmation-btn') || (target.matches('.modal-overlay') && !target.querySelector('.modal-content').contains(e.target))) { if (this.activeModal) this.closeModal(this.activeModal); return; }
            if (target.matches('.buy-btn')) { this.addToCart(target.dataset.id); return; }
            if (target.matches('.toast-cart-btn')) { if (this.activeModal) this.closeModal(this.activeModal); this.openModal(this.dom.cartModal); return; }
            if (target.matches('.toast-close-btn')) { target.closest('.toast').remove(); return; }
            if (target.matches('#clear-cart-btn')) { this.clearCart(); return; }
            if (target.matches('.quantity-btn')) { this.updateItemQuantity(target.closest('.cart-item').dataset.id, target.dataset.action); return; }
            if (target.matches('.cart-item-remove')) { this.updateItemQuantity(target.closest('.cart-item').dataset.id, 'remove'); return; }
            if (target.matches('#go-to-checkout-btn')) { this.startCheckout(); return; }
            if (target.matches('#confirm-purchase-btn')) { this.processOrder(target); return; }
            if (target.matches('.slide-arrow.next')) { this.changeSlide(this.activeModal, 1); return; }
            if (target.matches('.slide-arrow.prev')) { this.changeSlide(this.activeModal, -1); return; }
            if (target.matches('.dot')) { this.showSlide(this.activeModal, parseInt(target.dataset.slideTo, 10)); return; }
        },

        handleKeyboard(e) {
            if (e.key === 'Escape' && this.activeModal) this.closeModal(this.activeModal);
            if (e.key === 'Escape' && this.dom.mainNav.classList.contains('active')) this.toggleNav();
        },

        handleDelegatedInput(e) {
            if (e.target.matches('.quantity-input')) {
                const id = e.target.closest('.cart-item').dataset.id;
                let newQuantity = parseInt(e.target.value, 10);
                if (isNaN(newQuantity) || newQuantity < 1) newQuantity = 1;
                const item = this.cart.find(i => i.id === id);
                if (item) item.quantity = newQuantity;
                this.updateCartUI();
            }
        },
        
        handleDelegatedChange(e) {
            if (e.target.name === 'shipping-option' || e.target.id === 'upgrade-cards-checkbox') {
                this.updateCheckoutTotal();
            }
        },

        // --- UI & STATE MANAGEMENT ---
        toggleNav() {
            const isExpanded = this.dom.hamburgerMenu.getAttribute('aria-expanded') === 'true';
            this.dom.hamburgerMenu.setAttribute('aria-expanded', !isExpanded);
            this.dom.hamburgerMenu.classList.toggle('active');
            this.dom.mainNav.classList.toggle('active');
            document.body.classList.toggle('modal-open', !isExpanded);
        },
        
        getPriceHTML(product) {
            const formatPrice = (price) => `${price.toFixed(2).replace('.',',')} €`;
            if (product.discountPrice && product.discountPrice < product.originalPrice) {
                 return `
                    <span class="original-price">${formatPrice(product.originalPrice)}</span>
                    <span class="discounted-price">${formatPrice(product.discountPrice)}</span>
                `;
            } else {
                return `<span>${formatPrice(product.originalPrice)}</span>`;
            }
        },

        renderProducts(category) {
            this.dom.showcaseGrid.innerHTML = '';
            this.dom.modalContainer.innerHTML = '';
            const productsToRender = Object.entries(this.productData).filter(([, product]) => category === 'all' || product.category === category);
            
            if (productsToRender.length === 0) {
                this.dom.showcaseGrid.innerHTML = `<p>${this.translations[this.currentLanguage].no_products_found}</p>`;
                return;
            }
            
            productsToRender.forEach(([id, product]) => {
                // Render Card
                const cardTpl = this.dom.templates.productCard.content.cloneNode(true);
                const translatedName = product.name[this.currentLanguage];
                const imageContainer = cardTpl.querySelector('.showcase-item__image-container');
                imageContainer.querySelector('img').src = product.img;
                imageContainer.querySelector('img').alt = translatedName;
                
                // Discount Badge
                if (product.discountPrice && product.discountPrice < product.originalPrice) {
                    const percentage = Math.round(((product.originalPrice - product.discountPrice) / product.originalPrice) * 100);
                    const saleText = this.translations[this.currentLanguage].sale_badge.replace('{percent}', percentage);
                    const saleBadge = document.createElement('div');
                    saleBadge.className = 'sale-badge';
                    saleBadge.textContent = saleText;
                    imageContainer.appendChild(saleBadge);
                }
                
                cardTpl.querySelector('.name').textContent = translatedName;
                cardTpl.querySelector('.subtitle').textContent = product.subtitle[this.currentLanguage];
                cardTpl.querySelector('.price-container').innerHTML = this.getPriceHTML(product);
                cardTpl.querySelector('button').dataset.modalTarget = `${id}-modal`;
                this.dom.showcaseGrid.appendChild(cardTpl);
                
                // Prepare Modal
                const modalTpl = this.dom.templates.productModal.content.cloneNode(true);
                const modalEl = modalTpl.querySelector('.modal-overlay');
                modalEl.id = `${id}-modal`;
                const slideContainer = modalEl.querySelector('.slideshow-container');
                const dotContainer = modalEl.querySelector('.dot-container');
                product.images.forEach((imgUrl, index) => {
                    slideContainer.innerHTML += `<div class="slide"><img src="${imgUrl}" alt="${translatedName} View ${index + 1}"></div>`;
                    dotContainer.innerHTML += `<button class="dot" data-slide-to="${index}"></button>`;
                });
                modalEl.querySelector('.name').textContent = translatedName;
                modalEl.querySelector('.description').textContent = product.description[this.currentLanguage];
                modalEl.querySelector('.price-container').innerHTML = this.getPriceHTML(product);
                modalEl.querySelector('.buy-btn').dataset.id = id;
                this.dom.modalContainer.appendChild(modalTpl);
            });
        },

        openModal(modal) {
            if(!modal) return;
            this.lastFocusedElement = document.activeElement;
            modal.classList.add('active');
            document.body.classList.add('modal-open');
            this.activeModal = modal;
            if (modal.classList.contains('product-modal')) this.showSlide(modal, 0);
        },

        closeModal(modal) {
            if(!modal) return;
            modal.classList.remove('active');
            this.activeModal = null;
            if (!document.querySelector('.modal-overlay.active')) document.body.classList.remove('modal-open');
            if (this.lastFocusedElement) this.lastFocusedElement.focus();
        },

        showSlide(modal, index) {
            const slides = modal.querySelectorAll('.slide');
            const dots = modal.querySelectorAll('.dot');
            if (index >= slides.length || index < 0) return;
            slides.forEach((slide, i) => slide.classList.toggle('active', i === index));
            dots.forEach((dot, i) => dot.classList.toggle('active', i === index));
            modal.dataset.currentSlide = index;
        },

        changeSlide(modal, direction) {
            const slides = modal.querySelectorAll('.slide');
            let currentIndex = parseInt(modal.dataset.currentSlide || 0, 10);
            let newIndex = (currentIndex + direction + slides.length) % slides.length;
            this.showSlide(modal, newIndex);
        },
        
        showToast(messageKey, context = {}) {
            let message = this.translations[this.currentLanguage][messageKey] || messageKey;
            if(context.itemName) message = message.replace('{itemName}', context.itemName);

            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <button class="toast-close-btn" aria-label="Close">&times;</button>
                <p style="margin:0 0 0.5rem 0;">${message}</p>
                <button class="btn btn-secondary toast-btn toast-cart-btn">${this.translations[this.currentLanguage].toast_view_cart_btn}</button>
            `;
            this.dom.toastContainer.appendChild(toast);
            toast.addEventListener('animationend', (e) => { if (e.animationName === 'toast-out') toast.remove(); });
        },

        // --- CART LOGIC ---
        addToCart(id) {
            const existingItem = this.cart.find(item => item.id === id);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                const product = this.productData[id];
                const price = product.discountPrice && product.discountPrice < product.originalPrice ? product.discountPrice : product.originalPrice;
                this.cart.push({ id, name: product.name, price: price, img: product.img, quantity: 1 });
            }
            this.showToast('toast_item_added', { itemName: this.productData[id].name[this.currentLanguage] });
            this.updateCartUI();
        },

        updateItemQuantity(id, action) {
            const itemIndex = this.cart.findIndex(i => i.id === id);
            if (itemIndex === -1) return;
            if (action === 'remove') this.cart.splice(itemIndex, 1);
            else if (action === 'increase') this.cart[itemIndex].quantity++;
            else if (action === 'decrease' && this.cart[itemIndex].quantity > 1) this.cart[itemIndex].quantity--;
            this.updateCartUI();
        },

        updateCartUI() {
            this.renderCartItems();
            const totalItems = this.cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalCost = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            this.dom.cartCounter.textContent = totalItems;
            this.dom.cartCounter.style.display = totalItems > 0 ? 'block' : 'none';
            const totalText = this.translations[this.currentLanguage].cart_total;
            this.dom.cartTotal.innerHTML = `${totalText} <span>${totalCost.toFixed(2).replace('.',',')} €</span>`;
            this.saveCartToStorage();
        },

        renderCartItems() {
            this.dom.cartItemsList.innerHTML = '';
            if (this.cart.length === 0) {
                this.dom.cartItemsList.innerHTML = `<li>${this.translations[this.currentLanguage].cart_empty}</li>`;
                this.dom.checkoutBtn.disabled = true;
                return;
            }
            this.dom.checkoutBtn.disabled = false;
            this.cart.forEach(item => {
                const tpl = this.dom.templates.cartItem.content.cloneNode(true);
                const li = tpl.querySelector('.cart-item');
                li.dataset.id = item.id;
                li.querySelector('.cart-item-img').src = item.img;
                li.querySelector('.cart-item-name').textContent = item.name[this.currentLanguage];
                li.querySelector('.cart-item-price').textContent = `${item.price.toFixed(2).replace('.',',')} €`;
                li.querySelector('.quantity-input').value = item.quantity;
                this.dom.cartItemsList.appendChild(tpl);
            });
        },

        clearCart() {
            if (confirm(this.translations[this.currentLanguage].cart_clear_confirm)) {
                this.cart = [];
                this.updateCartUI();
            }
        },
        saveCartToStorage() { localStorage.setItem('heroquestCart', JSON.stringify(this.cart)); },
        loadCartFromStorage() {
            const savedCart = localStorage.getItem('heroquestCart');
            if (savedCart) {
                try { this.cart = JSON.parse(savedCart); } catch(e) { this.cart = []; }
            }
            this.updateCartUI();
        },

        // --- CHECKOUT PROCESS ---
        updateCheckoutTotal() {
            const subtotal = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shippingOption = document.querySelector('input[name="shipping-option"]:checked');
            const shippingCost = shippingOption ? parseFloat(shippingOption.dataset.cost) : 0;
            
            const upgradeCheckbox = document.getElementById('upgrade-cards-checkbox');
            const upgradeCost = upgradeCheckbox && upgradeCheckbox.checked ? 19.90 : 0;
            
            const grandTotal = subtotal + shippingCost + upgradeCost;
            
            const shippingCostDisplay = document.getElementById('shipping-cost-display');
            const upgradeCostLine = document.getElementById('upgrade-cost-line');
            const upgradeCostDisplay = document.getElementById('upgrade-cost-display');
            const grandTotalDisplay = document.getElementById('grand-total-display');

            if(shippingCostDisplay) shippingCostDisplay.textContent = `${shippingCost.toFixed(2).replace('.',',')} €`;

            if(upgradeCostLine) {
                if (upgradeCost > 0) {
                    upgradeCostDisplay.textContent = `${upgradeCost.toFixed(2).replace('.',',')} €`;
                    upgradeCostLine.style.display = 'flex';
                } else {
                    upgradeCostLine.style.display = 'none';
                }
            }

            if(grandTotalDisplay) grandTotalDisplay.textContent = `${grandTotal.toFixed(2).replace('.',',')} €`;
        },

        startCheckout() {
            if (this.cart.length === 0) return;
            this.closeModal(this.dom.cartModal);
            
            const subtotal = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const lang = this.currentLanguage;

            const checkoutHtml = `
                <button class="close-btn" aria-label="${this.translations[lang].aria_close}">&times;</button>
                <div class="modal-header"><h2 id="checkout-heading">${this.translations[lang].checkout_title}</h2></div>
                <div class="modal-body">
                    ${this.cart.map(item => `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span>${item.quantity}x ${item.name[lang]}</span>
                            <strong>${(item.price * item.quantity).toFixed(2).replace('.',',')} €</strong>
                        </div>
                    `).join('')}
                    <hr style="border-color: var(--border-dark); margin: 1rem 0;">
                    
                    <!-- NEW: Card Quality Upgrade Option -->
                    <div class="upgrade-option-box">
                        <h4>${this.translations[lang].checkout_upgrade_title}</h4>
                        <p>${this.translations[lang].checkout_upgrade_desc}</p>
                        <label>
                            <input type="checkbox" id="upgrade-cards-checkbox">
                            ${this.translations[lang].checkout_upgrade_label}
                        </label>
                    </div>

                    <!-- Shipping Options -->
                    <div style="text-align: left; margin-bottom: 1rem;">
                        <h4 style="margin-bottom: 0.75rem;">${this.translations[lang].checkout_shipping}</h4>
                        <div id="shipping-options">
                            <label style="display: block; cursor:pointer; margin-bottom: 0.5rem;">
                                <input type="radio" name="shipping-option" value="de" data-cost="6.19" checked>
                                ${this.translations[lang].checkout_shipping_de} (6,19 €)
                            </label>
                            <label style="display: block; cursor:pointer;">
                                <input type="radio" name="shipping-option" value="int" data-cost="26.49">
                                ${this.translations[lang].checkout_shipping_int} (26,49 €)
                            </label>
                        </div>
                    </div>
                    <hr style="border-color: var(--border-dark); margin: 1rem 0;">

                    <!-- Totals Section -->
                    <div style="text-align: right;">
                        <p style="margin: 0.5rem 0; display:flex; justify-content: space-between;">
                            <span>${this.translations[lang].checkout_subtotal}:</span>
                            <strong>${subtotal.toFixed(2).replace('.',',')} €</strong>
                        </p>
                        <p id="upgrade-cost-line" style="margin: 0.5rem 0; display:none; justify-content: space-between;">
                           <span>${this.translations[lang].checkout_upgrade_item_name}:</span>
                           <strong id="upgrade-cost-display"></strong>
                        </p>
                        <p style="margin: 0.5rem 0; display:flex; justify-content: space-between;">
                            <span>${this.translations[lang].checkout_shipping}:</span>
                            <strong id="shipping-cost-display"></strong>
                        </p>
                        <hr style="border-top: 1px solid var(--border-dark); margin: 0.5rem 0; border-bottom: none;">
                        <div style="font-size: 1.5rem; color: var(--text-light); margin-top: 1rem; display:flex; justify-content: space-between; align-items: center;">
                            <strong>${this.translations[lang].checkout_grand_total}:</strong>
                            <span id="grand-total-display" style="color: var(--accent-gold);"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" id="confirm-purchase-btn" style="width: 100%;">${this.translations[lang].checkout_pay_btn}</button>
                </div>
            `;
            this.dom.checkoutContainer.innerHTML = checkoutHtml;
            this.openModal(this.dom.checkoutModal);
            this.updateCheckoutTotal();
        },

        async processOrder(btn) {
            btn.disabled = true;
            btn.textContent = this.translations[this.currentLanguage].checkout_redirecting_btn;

            const selectedShippingEl = document.querySelector('input[name="shipping-option"]:checked');
            const upgradeCheckbox = document.getElementById('upgrade-cards-checkbox');
            
            // Create a temporary cart that includes the shipping cost and upgrades as line items
            const cartForStripe = this.cart.map(item => ({
                id: item.id,
                name: item.name.en, // Use English name for Stripe
                price: item.price,
                quantity: item.quantity
            }));

            // Add Card Upgrade if selected
            if (upgradeCheckbox && upgradeCheckbox.checked) {
                cartForStripe.push({
                    id: 'upgrade-original-cards',
                    name: this.translations['en'].checkout_upgrade_item_name, // Use English for Stripe
                    price: 19.90,
                    quantity: 1
                });
            }

            // Add Shipping
            if (selectedShippingEl) {
                const shippingCost = parseFloat(selectedShippingEl.dataset.cost);
                const shippingName = selectedShippingEl.value === 'de' 
                    ? this.translations['en'].checkout_shipping_de // "Shipping (Germany)"
                    : this.translations['en'].checkout_shipping_int; // "Shipping (International)"

                // Add shipping as a new item to the cart array being sent to the backend
                cartForStripe.push({
                    id: 'shipping-' + selectedShippingEl.value,
                    name: shippingName,
                    price: shippingCost,
                    quantity: 1
                });
            }

            const publicKey = 'pk_live_51SJvzbEIjtsqLIkTq3luQQKQjdDV5TNRQrUH33xsSkxLn2kbBYpl0KI06Xa5hMeXzSeOAH8tQ0kpIiFKn8yV6dPB00o2NtGiiu';
            const stripe = Stripe(publicKey);

            try {
                const response = await fetch('https://heroquest-2vvl.onrender.com/create-checkout-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        cart: cartForStripe, // Send the new cart array WITH the shipping item
                        locale: this.currentLanguage 
                    })
                });

                if (!response.ok) throw new Error('Server communication error.');

                const session = await response.json();
                const result = await stripe.redirectToCheckout({ sessionId: session.id });

                if (result.error) throw new Error(result.error.message);
            } catch (error) {
                alert('An error occurred: ' + error.message);
                btn.disabled = false;
                btn.textContent = this.translations[this.currentLanguage].checkout_pay_btn;
            }
        },
        
        checkPaymentStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('payment') === 'success') {
                this.cart = [];
                this.updateCartUI();
                this.openModal(this.dom.confirmationModal);
                 // Clean up URL
                window.history.replaceState({}, document.title, window.location.pathname);
            } else if (urlParams.get('payment') === 'cancelled') {
                this.showToast("toast_payment_cancelled");
                 // Clean up URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        },
    };

    document.addEventListener('DOMContentLoaded', () => {
        const banner = document.getElementById('construction-banner');
        const header = document.querySelector('header');
        
        const adjustHeaderTop = () => {
            if (banner && header) {
                const bannerHeight = banner.offsetHeight;
                header.style.top = `${bannerHeight}px`;
            }
        };

        adjustHeaderTop();
        window.addEventListener('resize', adjustHeaderTop);
        App.init();
    });
    </script>
</body>
</html>
